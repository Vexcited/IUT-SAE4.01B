#!/bin/bash

# Configuration des adresses ip
ip address add 10.0.0.2/28 dev eth0
ip address add 172.16.2.62/26 dev eth1
ip link set dev eth0 up
ip link set dev eth1 up

# Configuration des routes
ip route add default via 10.0.0.9
ip route add 172.16.1.0/24 via 10.0.0.1
ip route add 172.16.4.0/22 via 10.0.0.3
ip route add 172.16.8.0/22 via 10.0.0.4
ip route add 172.16.12.0/24 via 10.0.0.5
ip route add 172.16.16.0/22 via 10.0.0.6
ip route add 172.16.3.16/28 via 10.0.0.7
ip route add 172.16.20.0/24 via 10.0.0.8

# Configuration du server DNS
echo 'nameserver 172.16.3.17' > /etc/resolv.conf


# Politique par défaut pour bloquer tout par défaut
# iptables -P INPUT DROP
# iptables -P FORWARD DROP
# iptables -P OUTPUT ACCEPT

# Permettre les connexions établies et liées
# iptables -A FORWARD -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT

# Résolution DNS pour les patients
# iptables -A FORWARD -p udp --dport 53 -s 172.16.1.0/24 -d 172.16.3.17 -j ACCEPT
# iptables -A FORWARD -p udp --sport 53 -s 172.16.3.17 -d 172.16.1.0/24 -j ACCEPT

# Accès au site public de S (HTTP uniquement)
# iptables -A FORWARD -p tcp --dport 80 -s 172.16.1.0/24 -d 172.16.3.28 -j ACCEPT

# Accès Internet uniquement via HTTPS (pas de ping direct vers IP)
# iptables -A FORWARD -p tcp --dport 443 -s 172.16.1.0/24 -j ACCEPT

# Bloquer tout autre accès interne
# iptables -A FORWARD -s 172.16.1.0/24 -d 172.16.0.0/16 -j DROP
